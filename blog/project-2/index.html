<!DOCTYPE html>
<html lang="en-us">
    <head>
        
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<title>
H1 N1 Vaccination Status Classification - Czarina Luna
</title>



        
        <meta property="og:title" content="H1N1 Vaccination Status Classification - Czarina Luna" />
<meta property="og:type" content="website" />
<meta property="og:description" content=""/>
<meta property="og:url" content="//czarinaluna.com/blog/project-2/"/>
<meta property="og:site_name" content="Czarina Luna"/>



<meta property="og:image" content="//czarinaluna.com/blog/project-2/fig1.png"/>

<meta property="og:image" content="//czarinaluna.com/blog/project-2/fig4.png"/>

<meta property="og:image" content="//czarinaluna.com/blog/project-2/fig6.png"/>

<meta property="og:image" content="//czarinaluna.com/blog/project-2/fig7.png"/>

<meta property="og:image" content="//czarinaluna.com/blog/project-2/gabriella-clare-marino-HeIz1OoAl-A-unsplash.jpg"/>



        
<link rel="shortcut icon" href="/img/favicon.png">


        





<link rel="stylesheet" href="/css/main.min.267a336653a0bbe8778db2ec1104a18aef649cadc8f11b3c527b17612201117b.css" integrity="sha256-JnozZlOgu&#43;h3jbLsEQShiu9knK3I8Rs8UnsXYSIBEXs=" crossorigin="anonymous" media="screen">





        
        
        
        
    </head>
    <body>
        <section id="top" class="section">
            
            <div class="container hero  fade-in one ">
                

<h1 class="bold-title is-1">Project</h1>


            </div>
            
            <div class="section  fade-in two ">
                
<div class="container">
    <hr>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        
        <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false" >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
        <div class="navbar-menu " id="navMenu">
            
            
            
            
            <a class="navbar-item" href="/">main</a>
            

            
            

            
                
            

            
                
            

            
            
            
            
            
            <a class="navbar-item" href="/#about">Intro</a>
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="//czarinaluna.com/projects/">
                  
                  
                  Portfolio
                  
                  
                  </a>
                
                
            
            
            
            
            
                
                
                
                
                  <a class="navbar-item" href="//czarinaluna.com/blog/">
                  
                  Back to Project
                  
                  </a>
                
                
            
            
            
            
            
            <a class="navbar-item" href="/#interest">Interest</a>
            
            
            
            

            
            
            <a class="navbar-item" href="/#contact">Contact</a>
            
            

            

            
            
        </div>
    </nav>
    <hr>
</div>



                
<div class="container">
    <h2 class="title is-1 top-pad strong-post-title">
        <a href="//czarinaluna.com/blog/project-2/">H1N1 Vaccination Status Classification</a>
    </h2>
    
    <h4 class="title is-4">
        
        By&nbsp;Czarina Luna</h4>
    
    <div class="post-data">
        01 2022
        
         | 
        5 minutes read
        
    </div>
    
    <div class="blog-share">
        Share this:
        
        <a class="twitter-share-button"
            href="https://twitter.com/intent/tweet?text=H1N1%20Vaccination%20Status%20Classification%20%2f%2fczarinaluna.com%2fblog%2fproject-2%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fab fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>
        
        
        
    </div>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

</div>

<div class="container markdown top-pad">
    <p><img src="gabriella-clare-marino-HeIz1OoAl-A-unsplash.jpg" alt="header"></p>

<h3 id="i-overview" class="anchor-link"><a href="#i-overview">I. Overview</a></h3>
<p>An analysis and classification modeling of over 25,000 survey responses is completed to guide public health efforts on vaccination outreach. The highest accuracy and precision of 86% and 75% respectively is attained by the Extra Trees model predicting H1N1 vaccination status. According to the permutation importances of the model, the top features that affect H1N1 vaccination status are seasonal flu vaccination status, direct recommendation from a doctor, and health insurance.</p>

<h3 id="ii-business-problem" class="anchor-link"><a href="#ii-business-problem">II. Business Problem</a></h3>
<p>Public health agencies may be able to improve their vaccination outreach by understanding people&rsquo;s opinions and behaviors that may be related with whether they receive the vaccine or not. Doing so will guide public health efforts such as education campaigns to focus on the characteristics that are likely to result to vaccination as supported by relevant data. Using national survey responses, I describe vaccination patterns and classify H1N1 vaccination status based on features such as opinions on risks of H1N1 and vaccine effectiveness, and behaviors towards mitigating H1N1 transmission.</p>

<h3 id="iii-data-understanding" class="anchor-link"><a href="#iii-data-understanding">III. Data Understanding</a></h3>
<p>The H1N1 Flu Survey from late 2009 and early 2010 collected over 25,000 responses and covered questions about the individual&rsquo;s social, economic, and demographic background, opinions about the virus and the vaccine, and behaviors like protective measures observed. The dependent variable to predict is <code>h1n1_vaccine</code> that is the individual&rsquo;s vaccination status. The features are described in the <a href="https://www.drivendata.org/competitions/66/flu-shot-learning/page/211/#features_list">data source</a>.</p>
<p><strong>Imbalanced Dataset</strong></p>
<table>
<thead>
<tr>
<th>class</th>
<th>value_counts</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.787546</td>
</tr>
<tr>
<td>1</td>
<td>0.212454</td>
</tr>
</tbody>
</table>
<p>The ratio of class <code>0</code> for not vaccinated to class <code>1</code> for vaccinated is 80:20 or more concisely 4:1. To balance the class distribution, <em>random ovesampling</em> is done by randomly duplicating examples of the minority class <code>1</code> in the training set:</p>
<p><code>oversample = RandomOverSampler(sampling_strategy=0.5, random_state=112221)</code></p>
<p><code>X_train_res, y_train_res = oversample.fit_resample(X_train, y_train)</code></p>
<p><strong>Data Exploration</strong></p>
<details><summary>Missing Values:</summary>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#586e75"># Create dataframe for features and their missing values</span>
</span></span><span style="display:flex;"><span>null_values <span style="color:#719e07">=</span> pd<span style="color:#719e07">.</span>DataFrame(columns<span style="color:#719e07">=</span>[<span style="color:#2aa198">&#39;feature&#39;</span>, <span style="color:#2aa198">&#39;null&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">for</span> col <span style="color:#719e07">in</span> data<span style="color:#719e07">.</span>columns:
</span></span><span style="display:flex;"><span>    null_value <span style="color:#719e07">=</span> <span style="color:#b58900">round</span>((data[col]<span style="color:#719e07">.</span>isnull()<span style="color:#719e07">.</span>sum()<span style="color:#719e07">/</span><span style="color:#b58900">len</span>(data)<span style="color:#719e07">*</span><span style="color:#2aa198">100</span>), <span style="color:#2aa198">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">if</span> null_value <span style="color:#719e07">&gt;</span> <span style="color:#2aa198">5</span>:
</span></span><span style="display:flex;"><span>        null_values <span style="color:#719e07">=</span> null_values<span style="color:#719e07">.</span>append({<span style="color:#2aa198">&#39;feature&#39;</span>:col, <span style="color:#2aa198">&#39;null&#39;</span>:null_value}, ignore_index<span style="color:#719e07">=</span><span style="color:#cb4b16">True</span>)
</span></span></code></pre></div></details>
<table>
<thead>
<tr>
<th>feature</th>
<th>null (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td>doctor_recc_h1n1</td>
<td>8.09</td>
</tr>
<tr>
<td>doctor_recc_seasonal</td>
<td>8.09</td>
</tr>
<tr>
<td>health_insurance</td>
<td>45.96</td>
</tr>
<tr>
<td>education</td>
<td>5.27</td>
</tr>
<tr>
<td>income_poverty</td>
<td>16.56</td>
</tr>
<tr>
<td>marital_status</td>
<td>5.27</td>
</tr>
<tr>
<td>rent_or_own</td>
<td>7.65</td>
</tr>
<tr>
<td>employment_status</td>
<td>5.48</td>
</tr>
<tr>
<td>employment_industry</td>
<td>49.91</td>
</tr>
<tr>
<td>employment_occupation</td>
<td>50.44</td>
</tr>
</tbody>
</table>
<p>About half of the <code>employment_industry</code> and of <code>employment_occupation</code>, and almost half of the <code>health_insurance</code> values are missing. All the missing values will be imputed with the median for numerical features and the most frequent value for categorical features.</p>
<p><img src="fig1.png" alt=""></p>
<p>The features with the strongest correlation with H1N1 vaccination status are <code>doctor_recc_h1n1</code>, <code>seasonal_vaccine</code>, <code>opinion_h1n1_risk</code>, and <code>opinion_h1n1_vacc_effective</code>.</p>

<h3 id="iv-classification-modeling" class="anchor-link"><a href="#iv-classification-modeling">IV. Classification Modeling</a></h3>
<p><strong>Machine Learning Pipeline</strong></p>
<p>To automate the machine learning workflow, I put together a pipeline that imputes missing values, standardizes numerical features, and one hot encodes the categorical features.</p>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>numeric_transformer <span style="color:#719e07">=</span> Pipeline(
</span></span><span style="display:flex;"><span>    steps<span style="color:#719e07">=</span>[(<span style="color:#2aa198">&#39;num_imputer&#39;</span>, SimpleImputer(strategy<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;median&#39;</span>, add_indicator<span style="color:#719e07">=</span><span style="color:#cb4b16">True</span>)), 
</span></span><span style="display:flex;"><span>           (<span style="color:#2aa198">&#39;scaler&#39;</span>, StandardScaler())])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>categorical_transformer <span style="color:#719e07">=</span> Pipeline(
</span></span><span style="display:flex;"><span>    steps<span style="color:#719e07">=</span>[(<span style="color:#2aa198">&#39;cat_imputer&#39;</span>, SimpleImputer(strategy<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;most_frequent&#39;</span>)),
</span></span><span style="display:flex;"><span>           (<span style="color:#2aa198">&#39;ohe&#39;</span>, OneHotEncoder(sparse<span style="color:#719e07">=</span><span style="color:#cb4b16">False</span>, handle_unknown<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;ignore&#39;</span>))])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>preprocessor <span style="color:#719e07">=</span> ColumnTransformer(
</span></span><span style="display:flex;"><span>    transformers<span style="color:#719e07">=</span>[(<span style="color:#2aa198">&#39;num&#39;</span>, numeric_transformer, num_features),
</span></span><span style="display:flex;"><span>                  (<span style="color:#2aa198">&#39;cat&#39;</span>, categorical_transformer, cat_features)], remainder<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;passthrough&#39;</span>)
</span></span></code></pre></div><p><strong>Hyperparameter Tuning</strong> (<a href="https://github.com/czarinagluna/vaccination-status-classification/blob/main/GridSearch.ipynb">code</a>)</p>
<details><summary>Grid search is performed to optimize the models:</summary>
<div class="highlight"><pre tabindex="0" style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>tuned_params <span style="color:#719e07">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Create function to run grid search cv</span>
</span></span><span style="display:flex;"><span><span style="color:#719e07">def</span> <span style="color:#268bd2">grid_search</span>(params, name, scoring<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;accuracy&#39;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    Performs grid search on classification models, returns best cross validation scores and parameters
</span></span></span><span style="display:flex;"><span><span style="color:#2aa198">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#719e07">for</span> model, grid <span style="color:#719e07">in</span> params<span style="color:#719e07">.</span>items():
</span></span><span style="display:flex;"><span>        <span style="color:#b58900">print</span>(<span style="color:#2aa198">f</span><span style="color:#2aa198">&#39;Running... </span><span style="color:#2aa198">{</span>model<span style="color:#2aa198">}</span><span style="color:#2aa198"> GridSearch&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#b58900">print</span>(<span style="color:#2aa198">f</span><span style="color:#2aa198">&#39;Time Started: </span><span style="color:#2aa198">{</span>time<span style="color:#719e07">.</span>asctime()<span style="color:#2aa198">}</span><span style="color:#2aa198">&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        pipe <span style="color:#719e07">=</span> Pipeline(steps<span style="color:#719e07">=</span>[(<span style="color:#2aa198">&#39;col_transformer&#39;</span>, preprocessor), 
</span></span><span style="display:flex;"><span>                               (<span style="color:#2aa198">&#39;classifier&#39;</span>, default_models[model][<span style="color:#2aa198">&#39;classifier&#39;</span>])])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        gridsearch <span style="color:#719e07">=</span> GridSearchCV(estimator<span style="color:#719e07">=</span>pipe, param_grid<span style="color:#719e07">=</span>grid, scoring<span style="color:#719e07">=</span>scoring, cv<span style="color:#719e07">=</span><span style="color:#2aa198">5</span>)
</span></span><span style="display:flex;"><span>        gridsearch<span style="color:#719e07">.</span>fit(X_train_res, y_train_res)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#b58900">print</span>(<span style="color:#2aa198">f</span><span style="color:#2aa198">&#39;Time Finished: </span><span style="color:#2aa198">{</span>time<span style="color:#719e07">.</span>asctime()<span style="color:#2aa198">}</span><span style="color:#cb4b16">\n</span><span style="color:#2aa198">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#b58900">print</span>(<span style="color:#2aa198">f</span><span style="color:#2aa198">&#39;Best cross validation score: </span><span style="color:#2aa198">{</span>gridsearch<span style="color:#719e07">.</span>best_score_ <span style="color:#2aa198">:</span><span style="color:#2aa198">.2%</span><span style="color:#2aa198">}</span><span style="color:#2aa198">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#b58900">print</span>(<span style="color:#2aa198">f</span><span style="color:#2aa198">&#39;Optimal parameters: </span><span style="color:#2aa198">{</span>gridsearch<span style="color:#719e07">.</span>best_params_<span style="color:#2aa198">}</span><span style="color:#2aa198">&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        tuned_params[name] <span style="color:#719e07">=</span> gridsearch<span style="color:#719e07">.</span>best_params_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>params_lr1 <span style="color:#719e07">=</span> {<span style="color:#2aa198">&#39;LogisticRegression&#39;</span>: [{
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;classifier__penalty&#39;</span>:[<span style="color:#2aa198">&#39;l1&#39;</span>, <span style="color:#2aa198">&#39;l2&#39;</span>, <span style="color:#2aa198">&#39;elasticnet&#39;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;classifier__C&#39;</span>:[<span style="color:#2aa198">0.01</span>, <span style="color:#2aa198">0.1</span>, <span style="color:#2aa198">1</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;classifier__fit_intercept&#39;</span>:[<span style="color:#cb4b16">True</span>, <span style="color:#cb4b16">False</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#2aa198">&#39;classifier__solver&#39;</span>:[<span style="color:#2aa198">&#39;lbfgs&#39;</span>, <span style="color:#2aa198">&#39;saga&#39;</span>]
</span></span><span style="display:flex;"><span>}]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#586e75"># Run grid search on logistic regression model</span>
</span></span><span style="display:flex;"><span>grid_search(params_lr1, name<span style="color:#719e07">=</span><span style="color:#2aa198">&#39;LogisticRegression&#39;</span>)
</span></span></code></pre></div></details>
<p><strong>Classification Metrics</strong></p>
<p>Accuracy only reflects the underlying class distribution in an imbalanced dataset. If a model predicts not vaccinated all the time, it is already 80% accurate. So other classification metrics are used to measure the success of predictions.</p>
<ul>
<li>Precision measures how many are actually vaccinated out of all the people predicted to be vaccinated</li>
<li>Recall measures how many are correctly predicted to be vaccinated out of all the total vaccinated people</li>
</ul>
<p>Precision-recall curve is plotted below to show the tradeoff between the two. The AUC score is the area under the ROC curve that is plotted, too. It measures the performance of models across all classification thresholds.</p>
<p><img src="fig4.png" alt=""></p>
<p>More specifically, precision is important to the business problem because a false positive is worse than a false negative, in this case. To predict that an individual receives the vaccine but actually does not is a bigger loss than to predict that an individual does not receive the vaccine but actually does—because the actually vaccinated individual <em>is vaccinated</em> but the indivual who is not vaccinated is <strong>missed</strong>.</p>

<h3 id="v-results-and-recommendations" class="anchor-link"><a href="#v-results-and-recommendations">V. Results and Recommendations</a></h3>
<p>The <strong>Tuned Extra Trees</strong> has the highest cross validation score for accuracy at 96% and the highest precision score of 75% out of all the models.</p>
<p><img src="models.png" alt=""></p>
<p>The tuned Extra Trees classifier&rsquo;s accuracy score on the <code>test_set</code> is 86%.</p>
<p><img src="fig6.png" alt=""></p>
<p>Comparing the confusion matrices of the baseline model and the final model, the false positive is reduced by half from 0.086 to 0.042 under the Extra Trees model.</p>
<p><strong>Permutation Importances</strong></p>
<blockquote>
<p>&ldquo;Permutation importance does not reflect to the intrinsic predictive value of a feature by itself but <strong>how important this feature is for a particular model</strong>.&rdquo; (<a href="https://scikit-learn.org/stable/modules/permutation_importance.html">scikit-learn</a>)</p>
</blockquote>
<p>To identify the top features related to H1N1 vaccination status on the final model, I plot the permutation importances of the Extra Trees classifier:</p>
<pre tabindex="0"><code>result = permutation_importance(final, X_test, y_test, n_repeats=10, random_state=20211122, n_jobs=2)
sorted_idx = result.importances_mean.argsort()[::-1]

plt.style.use(&#39;ggplot&#39;)
fig, ax = plt.subplots(figsize=(20,10))
plt.subplots_adjust(bottom=0.2)

# Plot the permutation importances of the final model
ax.boxplot(result.importances[sorted_idx].T, vert=True)

ax.set_ylim(top=0.05)
ax.set_title(&#39;Permutation Importances&#39;, fontsize=20)
ax.set_xticklabels(X_test.columns[sorted_idx], rotation=90)

plt.grid(linestyle=&#39;--&#39;, color=&#39;lightgray&#39;)
plt.savefig(&#39;data/images/fig7.png&#39;, dpi=200, transparent=True)
plt.show()
</code></pre><p><img src="fig7.png" alt=""></p>
<p>The top features that affect H1N1 vaccination status on the final model are <code>seasonal_vaccine</code>, <code>doctor_recc_h1n1</code>, and <code>health_insurance</code>.</p>
<p><strong>Recommendations</strong></p>
<ul>
<li>Direct efforts to individuals who receive the seasonal flu vaccine by providing information about and reminders to receive the H1N1 vaccine, too.</li>
<li>Coordinate with primary health care providers to educate and recommend the vaccine to patients.</li>
<li>Focus vaccination campaigns on a message that the vaccines are free and available for the uninsured.</li>
</ul>
<p><strong>Model Deployment</strong></p>
<p>Finally, I deploy the Extra Trees classifier model as an online survey to demonstrate the prediction of vaccination status after answering the questions.</p>
<hr>
<p>Source Code: <strong><a href="https://github.com/czarinagluna/vaccination-status-classification/">Github Repository</a></strong></p>

<h1 id="contact" class="anchor-link"><a href="#contact">Contact</a></h1>
<p>Feel free to contact me for any questions and connect with me on <a href="https://www.linkedin.com/in/czarinagluna/">Linkedin</a>.</p>

</div>





                
                <div class="container">
    <hr>
</div>
<div class="container has-text-centered top-pad">
    <a href="#top">
        <i class="fa fa-arrow-up"></i>
    </a>
</div>

<div class="container">
    <hr>
</div>

                <div class="section" id="footer">
    <div class="container has-text-centered">
    
        <span class="footer-text">
            <img src="signature.png" width="200px"><br>
            Copyright 2022. Powered by <a href="https://themes.gohugo.io/themes/hugo-theme-introduction/"><strong>Introduction</strong></a> theme for <a href="http://gohugo.io/">Hugo</a>.
        </span>
    
    </div>
</div>

                
            </div>
        </section>
        
        


<script src="//czarinaluna.com/js/bundle.5c23c0437f001a469ca373a465a6f7487203d18e10cdff76d86a60af66d5ee28.js" integrity="sha256-XCPAQ38AGkaco3OkZab3SHID0Y4Qzf922Gpgr2bV7ig="></script>






        
        
        
        
    </body>
</html>
